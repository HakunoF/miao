<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>huaban</title>
  <style>
    section {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      margin: auto;
    }

    section div {
      flex: 1;
    }

    img {
      display: block;
      margin-bottom: 10px;
      transition: .3s;
    }



  </style>
</head>
<body>
  <section>
  </section>

  <script>
    var cats = [
      {
        "url": "photo-103450229.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/photo-103450229.jpg",
        "width": 675,
        "height": 900
      },
      {
        "url": "photo-108273877.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/photo-108273877.jpg",
        "width": 1170,
        "height": 780
      },
      {
        "url": "photo-115203323.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/photo-115203323.jpg",
        "width": 1170,
        "height": 780
      },
      {
        "url": "photo-23583825.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/photo-23583825.jpg",
        "width": 2048,
        "height": 1536
      },
      {
        "url": "stock-photo-123942383.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-123942383.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-124559545.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-124559545.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-132046989.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-132046989.jpg",
        "width": 1170,
        "height": 780
      },
      {
        "url": "stock-photo-132118343.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-132118343.jpg",
        "width": 2000,
        "height": 1339
      },
      {
        "url": "stock-photo-132311221.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-132311221.jpg",
        "width": 1920,
        "height": 1080
      },
      {
        "url": "stock-photo-132586903.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-132586903.jpg",
        "width": 2000,
        "height": 1334
      },
      {
        "url": "stock-photo-135203031.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-135203031.jpg",
        "width": 1000,
        "height": 668
      },
      {
        "url": "stock-photo-135626379.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-135626379.jpg",
        "width": 2000,
        "height": 1500
      },
      {
        "url": "stock-photo-136947953.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-136947953.jpg",
        "width": 2000,
        "height": 1348
      },
      {
        "url": "stock-photo-138378295.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-138378295.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-138436811.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-138436811.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-142950305.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-142950305.jpg",
        "width": 2000,
        "height": 1125
      },
      {
        "url": "stock-photo-143046061.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-143046061.jpg",
        "width": 843,
        "height": 1000
      },
      {
        "url": "stock-photo-143181649.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-143181649.jpg",
        "width": 2000,
        "height": 1298
      },
      {
        "url": "stock-photo-144530143.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-144530143.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-144730939.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-144730939.jpg",
        "width": 1000,
        "height": 1000
      },
      {
        "url": "stock-photo-145414771.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-145414771.jpg",
        "width": 780,
        "height": 1170
      },
      {
        "url": "stock-photo-146038669.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-146038669.jpg",
        "width": 2000,
        "height": 1335
      },
      {
        "url": "stock-photo-146231033.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-146231033.jpg",
        "width": 2000,
        "height": 1335
      },
      {
        "url": "stock-photo-146914861.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-146914861.jpg",
        "width": 843,
        "height": 1000
      },
      {
        "url": "stock-photo-147877407.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-147877407.jpg",
        "width": 2000,
        "height": 1334
      },
      {
        "url": "stock-photo-147969173.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-147969173.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-148015373.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-148015373.jpg",
        "width": 1170,
        "height": 781
      },
      {
        "url": "stock-photo-148704233.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-148704233.jpg",
        "width": 1170,
        "height": 884
      },
      {
        "url": "stock-photo-148928293.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-148928293.jpg",
        "width": 1170,
        "height": 781
      },
      {
        "url": "stock-photo-148950715.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-148950715.jpg",
        "width": 1170,
        "height": 775
      },
      {
        "url": "stock-photo-21951271.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-21951271.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-21964829.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-21964829.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-22618399.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-22618399.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-31201539.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-31201539.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-34598868.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-34598868.jpg",
        "width": 542,
        "height": 768
      },
      {
        "url": "stock-photo-47252094.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-47252094.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-51980510.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-51980510.jpg",
        "width": 666,
        "height": 1000
      },
      {
        "url": "stock-photo-55601508.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-55601508.jpg",
        "width": 666,
        "height": 1000
      },
      {
        "url": "stock-photo-65681789.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-65681789.jpg",
        "width": 1840,
        "height": 1232
      },
      {
        "url": "stock-photo-70461471.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-70461471.jpg",
        "width": 1000,
        "height": 1000
      },
      {
        "url": "stock-photo-71801901.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-71801901.jpg",
        "width": 2000,
        "height": 1335
      },
      {
        "url": "stock-photo-71913567.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-71913567.jpg",
        "width": 2000,
        "height": 1328
      },
      {
        "url": "stock-photo-72223295.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-72223295.jpg",
        "width": 2000,
        "height": 1335
      },
      {
        "url": "stock-photo-72620185.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-72620185.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-74402039.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-74402039.jpg",
        "width": 666,
        "height": 1000
      },
      {
        "url": "stock-photo-75097491.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-75097491.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-75186237.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-75186237.jpg",
        "width": 2000,
        "height": 1333
      },
      {
        "url": "stock-photo-79250373.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-79250373.jpg",
        "width": 2000,
        "height": 1325
      },
      {
        "url": "stock-photo-79692589.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-79692589.jpg",
        "width": 670,
        "height": 1000
      },
      {
        "url": "stock-photo-7979718.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-7979718.jpg",
        "width": 1024,
        "height": 680
      },
      {
        "url": "stock-photo-7980252.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-7980252.jpg",
        "width": 1024,
        "height": 680
      },
      {
        "url": "stock-photo-81390687.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-81390687.jpg",
        "width": 2000,
        "height": 1591
      },
      {
        "url": "stock-photo-81988949.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-81988949.jpg",
        "width": 667,
        "height": 1000
      },
      {
        "url": "stock-photo-83149705.jpg",
        "fullUrl": "https://xieranmaya.github.io/images/cats/stock-photo-83149705.jpg",
        "width": 775,
        "height": 1170
      }
    ]
    cats = [...cats, ...cats]
    cats = [...cats, ...cats]
    cats = [...cats, ...cats]
    cats = [...cats, ...cats]
    cats = [...cats, ...cats]

    var section = document.querySelector('section')
    var prevWidth = 0

    function run() {
      if (window.innerWidth == prevWidth) {
        return
      } else {
        prevWidth = window.innerWidth
      }

      section.innerHTML = ''
      var columns = window.innerWidth / 200 | 0 //页面最多能够塞下x列

      for (var i = 0; i < columns; i++) { //创建x列div元素
        section.append(document.createElement('div'))
      }

      var divs = [...document.querySelectorAll('div')] //用all才能选取所有的div

      var colWidth = divs[0].offsetWidth  //得到每列的宽度
      var colHeight = Array(columns).fill(0) //创建数组记录每一列的高度
      var colImgs = Array(columns).fill(0).map(it => []) //创建数组累计每列的图片，必须用map，如直接fill([])会指向同一个数组

      for (var cat of cats) {
        var minDivHeight = Math.min(...colHeight) //取高度最小的div列
        var minIdx = colHeight.indexOf(minDivHeight) //得到高度最小的div列下标

        var img = document.createElement('img') //创建img元素并确定宽高
        img.src = cat.fullUrl
        img.width = colWidth
        img.height = colWidth * cat.height / cat.width

        colHeight[minIdx] += img.height + 10 //图片将加入的div列，更新其记录数组
        colImgs[minIdx].push(img) //图片加入高度最小的div列

        colImgs.forEach((imgs, idx) => { //将累计图片的数组每一项append进对应的div
          divs[idx].append(...imgs)
        })

        // var div = divs.reduce((min, div) => { //选取累积高度最小的div插入图片
        //   if (min.offsetHeight <= div.offsetHeight) {
        //     return min
        //   } else {
        //     return div
        //   }
        // }, divs[0])
      }
    }
    run()
    window.onresize = run

    var z = 66
    section.addEventListener('click', function(e) {
      if (e.target.matches('section > div img')) {
        var img = e.target

        if (img.style.transform == '') {
          var box = img.getBoundingClientRect()
          var baseX = box.left + box.width / 2 //得出被点击的图片此时的坐标xy
          var baseY = box.top + box.height / 2
          var centerX = window.innerWidth / 2 //中心点坐标
          var centerY = window.innerHeight / 2
          var moveX = centerX - baseX  //xy各自的移动距离
          var moveY = centerY - baseY
          var zoomX = window.innerWidth / box.width
          var zoomY = window.innerHeight / box.height

          img.style.zIndex = z++ //选中的img放大并显示在页面最上层
          img.style.transform = `translate(${moveX}px, ${moveY}px) scale(${Math.min(zoomX, zoomY)})`
          img.style.boxShadow = '0 0 0 9999px black'
        } else {
          img.style.transform = ''
          img.style.boxShadow = ''
        }

      }
    })



  </script>

</body>
</html>
